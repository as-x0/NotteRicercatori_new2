<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>FAOSTAT Game - Giocatore</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { padding: 5px; margin: 5px; }
    datalist option { font-size: 14px; }
  </style>
</head>
<body>
  <h1>Giocatore</h1>
  <label>Codice Stanza:
    <input type="text" id="roomIdInput">
  </label>
  <label>Nome:
    <input type="text" id="nameInput">
  </label>
  <button id="joinRoomBtn">Entra</button>

  <div id="gameArea" style="display:none;">
    <h3>Paesi disponibili</h3>
    <input list="countriesList" id="countryInput" placeholder="Inserisci paese">
    <datalist id="countriesList"></datalist>
    <button id="selectCountryBtn">Scegli Paese</button>

    <h3>I tuoi paesi:</h3>
    <ul id="myCountries"></ul>

    <h3>Classifica:</h3>
    <ul id="leaderboard"></ul>
  </div>

  <script>
    const socket = io();

    const joinRoomBtn = document.getElementById("joinRoomBtn");
    const roomIdInput = document.getElementById("roomIdInput");
    const nameInput = document.getElementById("nameInput");
    const gameArea = document.getElementById("gameArea");
    const countryInput = document.getElementById("countryInput");
    const countriesList = document.getElementById("countriesList");
    const myCountriesEl = document.getElementById("myCountries");
    const leaderboardEl = document.getElementById("leaderboard");

    let currentRoomId = null;
    let myCountries = [];

    joinRoomBtn.onclick = () => {
      const roomId = roomIdInput.value.trim();
      const name = nameInput.value.trim();
      if (roomId && name) {
        currentRoomId = roomId;
        socket.emit("joinRoom", { roomId, name });
      }
    };

    socket.on("playerList", (players) => {
      const me = players.find(p => p.name === nameInput.value);
      if (me) {
        myCountries = me.countries;
        myCountriesEl.innerHTML = myCountries.map(c => `<li>${c}</li>`).join("");
      }
    });

    socket.on("settingsUpdated", (settings) => {
      console.log("ðŸ“‹ Impostazioni di gioco:", settings);
    });

    socket.on("gameStarted", (settings) => {
      gameArea.style.display = "block";
    });

    document.getElementById("selectCountryBtn").onclick = () => {
      const country = countryInput.value.trim();
      if (country) {
        socket.emit("selectCountry", { roomId: currentRoomId, country });
        countryInput.value = "";
      }
    };

    socket.on("countriesList", (countries) => {
      countriesList.innerHTML = countries.map(c => `<option value="${c}">`).join("");
    });

    socket.on("gameEnded", (leaderboard) => {
      leaderboardEl.innerHTML = leaderboard.map(p => `<li>${p.name}: ${p.score}</li>`).join("");
    });

    socket.on("errorMsg", (msg) => {
      alert(msg);
    });
  </script>
</body>
</html>
